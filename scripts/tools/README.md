## Tools folder

This tools folder stores all the important classes / functions to run simulations, calculate predictions, and generate plots. Here is a brief description of each script file. For more information about each function / step, please refer to the `UserManual.pdf` and/or the in-line comments within the code.

* `AI.py` simulates a triage AI device given an empirical ROC curve via a CSV file. The data points in CSV file are used to re-build the diseased and non-diseased histograms assuming a bi-normal distribution. In this assumption, non-diseased histogram is centered at 0 with a standard deviation of 1. The mu and sigma of the diseased histogram are determined based on the fit. All fits are performed when the AI object is first initiated. During simulation, the AI instance will determine the AI-call of a given patient based on its disease truth status. On 10/28/2022, a new class method is implemented to take a single operating threshold instead of an ROC curve with a bi-normal assumption.
* `calculator.py` contains all theoretical calculations to predict the state probability of the number of patients in system (observed by every in-coming patient) as well as the mean waiting time. Specifically, `get_theory_waitTime()` calculates the theoretical average waiting times and mean time-saving. For more information on the methodology, please visit 
    1. [Osogami et al (2005)](https://www.cs.cmu.edu/~harchol/Papers/quasi-minimal-PH.pdf) Closed form solutions for mapping general distributions to quasi-minimal PH distributions;
    2. [Harchol-Balter et al (2005)](https://www.cs.cmu.edu/~harchol/Papers/questa.pdf) Multi-server queueing systems with multiple priority classes
    3. [Osogami's thesis (2005)](http://reports-archive.adm.cs.cmu.edu/anon/2005/CMU-CS-05-136.pdf) Analysis of Multi-server Systems via Dimensionality Reduction of Markov Chains
* `inputHandler.py` contains functions that handle input user values, either as argument flags or as an input file. Based on that, an output params is returned for simulation to run on.
* `patients.py` encapsulates a patient class, storing information related to interrupting status, disease (radiologist diagnosis) status, AI call, and timestamps including trigger (arrival) time, radiologist's reading time, waiting time, total time in system, etc. Each patient has a unique ID based on the arrival time, which is used to compare one patient to another.
* `plotter.py` includes functions that plot image workflow and various distributions such as number of patient iamges in queue and their wait time for different priority classes.
* `radiologist.py` encapsulates a server (radiologist) class. Each radiologist has a name and the current patient (a patient instance that contains all the information about the patient case in this radiologist's hand). The "current patient" instance will be updated as the radiologist gets interrupted or reads a new case. 
* `trialGenerator.py` defines a class that generate trials. This class passes user input parameters and calls the simulator class to simulate reading flow. This script is used when you want the results from one single computer. If you have a cluster, you can run individual trials in parallel without using this script.
* `simulator.py` is probably the most important class. It simulates one trial of reading flow. Incoming patients are placed in both with- and without-CADt scenarios. In both scenarios, a preemptive resume scheduling is assumed. Each patient has a unique ID based on its order of arrival, and the ID is compared when action points are reached (e.g. when a radiologist reads a new case, when it closes a case, when it is interrupted by higher-priority case, and when a new patient enters the system, etc.). At each action time point, the queue is changed (e.g. adding new patient, putting interrupted patient back to the queue, removing a patient from the queue, etc.). This simulation software keeps track of all information from all patients in the queueing system, including the disease/interrupting status, the AI call, the reading duration (i.e. service time), the various timestamps (arrival, case open/closed, interrupted, etc.), the waiting time, etc. When a patient arrives, the number of patients in the system per priority class *right before the patient's arrival* are recorded to form the state probability distribution for this simulation trial. Besides the simulations itself, this class also has functions for debugging purposes, including the option to print a log file of all patients and the functions to extract patients of specific subgroups. Note that emergency and interrupting are interchangeable in this script. Emergency patients do NOT refer to patients in emergency department. Instead, "emergency" refers to interrupting (emergent, urgent) cases that require immediate attention and interrupt the radiologist's reading the images in the reading queue. CADt devices are meant to only triage cases in the reading queue not interrupting cases.
